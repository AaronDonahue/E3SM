module five_intr

!-------------------------------------------
! Module to interface FIVE With E3SM

  use shr_kind_mod,  only: r8=>shr_kind_r8

  implicit none
  
  integer :: five_add_nlevels
  integer, parameter :: pver_five = 93
  integer, parameter :: pverp_five = 94
  
  real(r8) :: pmid_five(pver_five)
  real(r8) :: pint_five(pverp_five) 
  
  data pmid_five /0.123825412243605_r8, 0.182829238474369_r8, 0.269948869943619_r8, &
    0.398581713438034_r8, 0.588509157299995_r8, 0.868938595056534_r8, 1.2829949259758_r8, &
    1.89435243606567_r8, 2.79702687263489_r8, 4.12983322143555_r8, 5.96844935417175_r8, &
    8.37740421295166_r8, 11.4737873077393_r8, 15.3339381217957_r8, 19.996337890625_r8, &
    25.4446964263916_r8, 31.5932512283325_r8, 38.366283416748_r8, 45.6711978912354_r8, &
    53.3095607757568_r8, 61.0151805877686_r8, 68.476390838623_r8, 75.3553352355957_r8, &
    81.9462738037109_r8, 88.9105453491211_r8, 96.4666748046875_r8, 104.664966583252_r8, &
    113.560001373291_r8, 123.210994720459_r8, 133.682182312012_r8, 145.043266296387_r8, &
    157.36988067627_r8, 170.744079589844_r8, 185.254898071289_r8, 200.99893951416_r8, &
    218.081001281738_r8, 236.614791870117_r8, 256.723686218262_r8, 278.541549682617_r8, &
    302.213638305664_r8, 327.897506713867_r8, 355.764129638672_r8, 385.9990234375_r8, &
    418.803451538086_r8, 454.395812988281_r8, 492.46858215332_r8, 531.639526367188_r8, &
    570.624908447266_r8, 608.643798828125_r8, 645.319976806641_r8, 680.498046875_r8, &
    705.679107666016_r8, 721.730560302734_r8, 737.115539550781_r8, 751.834259033203_r8, & 
    765.778259277344_r8, 778.947540283203_r8, 791.242553710938_r8, 802.663208007812_r8, &
    813.121215820312_r8, 822.616638183594_r8, 831.229614257812_r8, 838.960540771484_r8, &
    846.243560791016_r8, 853.078704833984_r8, 859.836212158203_r8, 866.516235351562_r8, &
    873.113708496094_r8, 879.627899169922_r8, 886.053924560547_r8, 892.391815185547_r8, &
    898.636291503906_r8, 904.787506103516_r8, 910.840515136719_r8, 916.794982910156_r8, &
    922.64599609375_r8, 928.393768310547_r8, 934.033264160156_r8, 939.564727783203_r8, &
    944.983215332031_r8, 950.288940429688_r8, 955.477447509766_r8, 960.54833984375_r8, &
    965.497344970703_r8, 970.324768066406_r8, 975.026275634766_r8, 979.601837158203_r8, &
    984.047332763672_r8, 988.363037109375_r8, 992.139038085938_r8, 995.374938964844_r8, &
    997.744415283203_r8, 999.247985839844_r8/  
    

    
  data pint_five /0.100000001490116, 0.147650822997093, 0.218007653951645, &
    0.321890085935593, 0.475273340940475, 0.701744973659515, &
    1.03613221645355, 1.52985763549805, 2.2588472366333, 3.33520650863647, &
    4.92445993423462, 7.01243877410889, 9.74236965179443, 13.2052049636841, &
    17.4626712799072, 22.5300045013428, 28.3593883514404, 34.8271141052246, &
    41.9054527282715, 49.4369430541992, 57.1821784973145, 64.8481826782227, &
    72.1045989990234, 78.606071472168, 85.2864761352539, 92.5346145629883, &
    100.398735046387, 108.931198120117, 118.188804626465, 128.233184814453, &
    139.13117980957, 150.955352783203, 163.784408569336, 177.703750610352, &
    192.806045532227, 209.191833496094, 226.970169067383, 246.259414672852, &
    267.187957763672, 289.895141601562, 314.532135009766, 341.262878417969, &
    370.265380859375, 401.732666015625, 435.874237060547, 472.917388916016, &
    512.019775390625, 551.25927734375, 589.990539550781, 627.297058105469, &
    663.342895507812, 697.653198242188, 713.705017089844, 729.756103515625, &
    744.474975585938, 759.193542480469, 772.362976074219, 785.532104492188, &
    796.953002929688, 808.373413085938, 817.869018554688, 827.3642578125, &
    835.094970703125, 842.826110839844, 849.661010742188, 856.496398925781, & 
    863.176025390625, 869.8564453125, 876.370971679688, 882.884826660156, &
    889.223022460938, 895.560607910156, 901.711975097656, 907.863037109375, & 
    913.817993164062, 919.77197265625, 925.52001953125, 931.267517089844, &
    936.799011230469, 942.330444335938, 947.635986328125, 952.94189453125, &
    958.013000488281, 963.083679199219, 967.911010742188, 972.738525390625, &
    977.314025878906, 981.8896484375, 986.205017089844, 990.521057128906, &
    993.757019042969, 996.992858886719, 998.495971679688, 1000/    
  
  contains 
  
  ! ======================================== !
  !                                          !
  ! ======================================== !    
  
  subroutine five_readnl(nlfile)
  
    use spmd_utils,    only: masterproc  
    use units,         only: getunit, freeunit
    use namelist_utils,  only: find_group_name
    use cam_abortutils,         only: endrun
     
    character(len=*), intent(in) :: nlfile  ! filepath for file containing namelist input
    
    integer :: iunit, read_status
    
    namelist /five_nl/ five_add_nlevels
    
    !----- Begin Code -----
    
    !  Initialize some FIVE parameters
    five_add_nlevels = 1 
    
    !  Read namelist to determine FIVE parameters
    if (masterproc) then
      iunit = getunit()
      open( iunit, file=trim(nlfile), status='old' ) 
      
      call find_group_name(iunit, 'five_nl', status=read_status)
      if (read_status == 0) then
         read(unit=iunit, nml=five_nl, iostat=read_status)
         if (read_status /= 0) then
            call endrun('five_readnl:  error reading namelist')
         end if
      end if        
      
      close(unit=iunit)
      call freeunit(iunit)
    end if
    
#ifdef SPMD
! Broadcast namelist variables
      call mpibcast(five_add_nlevels,            1,   mpiint,   0, mpicom)
#endif           
  
  end subroutine five_readnl
  
  ! ======================================== !
  !                                          !
  ! ======================================== !
  
  subroutine five_init_cam()

  ! Here we initialize the FIVE grid
  
  ! For now, for testing purposes, let's just
  !  hardcode the levels in.  Future implementaitons
  !  will involve algorithm to generate the needed
  !  levels
  
  ! define pver_five, pverp_five
  !  define the arrays pmid_five and pint_five  
  
  ! default pver = 72, pverp = 73
  
  
  end subroutine five_init_cam

end module five_intr
